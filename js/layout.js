// Â∏ÉÂ±ÄÁªÑ‰ª∂ - header„ÄÅfooter„ÄÅarticle-metaÁ≠âÈ°µÈù¢Â∏ÉÂ±ÄÁõ∏ÂÖ≥ÁªÑ‰ª∂

// =============== ÁßªÂä®Á´ØËèúÂçïÁÆ°ÁêÜÂô® ===============
let mobileMenuManager = null;

function createMobileMenuManager() {
    // Â¶ÇÊûúÂ∑≤Â≠òÂú®ÁÆ°ÁêÜÂô®ÔºåÂÖàÈîÄÊØÅ
    if (mobileMenuManager) {
        mobileMenuManager.destroy();
        mobileMenuManager = null;
    }

    mobileMenuManager = {
        isToggling: false,
        isInitialized: false,
        outsideClickHandler: null,
        buttonClickHandler: null,

        init: function() {
            if (this.isInitialized) return;

            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');

            if (!button || !menu) return;

            console.log('üîß ÂàùÂßãÂåñÁßªÂä®Á´ØËèúÂçïÁÆ°ÁêÜÂô®');

            // ÈáçÁΩÆÁä∂ÊÄÅ
            menu.classList.add('hidden');
            button.setAttribute('aria-expanded', 'false');
            this.isToggling = false;

            // ÂàõÂª∫ÁªëÂÆöÁöÑ‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞
            this.buttonClickHandler = (event) => {
                console.log('üì± ËèúÂçïÊåâÈíÆË¢´ÁÇπÂáª');
                event.preventDefault();
                event.stopPropagation();
                event.stopImmediatePropagation();

                if (this.isToggling) {
                    console.log('‚è≥ ËèúÂçïÊ≠£Âú®ÂàáÊç¢‰∏≠ÔºåÂøΩÁï•ÁÇπÂáª');
                    return;
                }

                this.toggle();
            };

            this.outsideClickHandler = (event) => {
                const button = document.getElementById('mobile-menu-button');
                const menu = document.getElementById('mobile-menu');

                if (!button || !menu) return;

                const isExpanded = button.getAttribute('aria-expanded') === 'true';
                if (isExpanded && !menu.contains(event.target) && !button.contains(event.target)) {
                    console.log('üñ±Ô∏è ÁÇπÂáªÂ§ñÈÉ®Âå∫ÂüüÔºåÂÖ≥Èó≠ËèúÂçï');
                    this.close();
                }
            };

            // ÁªëÂÆö‰∫ã‰ª∂
            button.addEventListener('click', this.buttonClickHandler, { capture: true });

            // ËèúÂçïÂÆπÂô®ÁÇπÂáª‰∫ã‰ª∂ - ÈòªÊ≠¢ÂÜíÊ≥°
            const container = menu.querySelector('.mobile-menu-container');
            if (container) {
                container.addEventListener('click', (e) => {
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                });
            }

            // ËèúÂçïÈ°πÁÇπÂáª‰∫ã‰ª∂
            const links = menu.querySelectorAll('.mobile-nav-link');
            links.forEach(link => {
                link.addEventListener('click', () => {
                    console.log('üîó ËèúÂçïÈ°πË¢´ÁÇπÂáªÔºåÂÖ≥Èó≠ËèúÂçï');
                    this.close();
                });
            });

            // Âª∂ËøüÁªëÂÆöÂ§ñÈÉ®ÁÇπÂáª‰∫ã‰ª∂ÔºåÈÅøÂÖçÁ´ãÂç≥Ëß¶Âèë
            setTimeout(() => {
                document.addEventListener('click', this.outsideClickHandler);
            }, 100);

            this.isInitialized = true;
            console.log('‚úÖ ÁßªÂä®Á´ØËèúÂçïÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');
        },

        toggle: function() {
            const button = document.getElementById('mobile-menu-button');
            if (!button) return;

            const isExpanded = button.getAttribute('aria-expanded') === 'true';
            console.log(`üîÑ ÂàáÊç¢ËèúÂçïÁä∂ÊÄÅ: ${isExpanded ? 'ÂÖ≥Èó≠' : 'ÊâìÂºÄ'}`);

            if (isExpanded) {
                this.close();
            } else {
                this.open();
            }
        },

        open: function() {
            if (this.isToggling) return;
            this.isToggling = true;

            console.log('üìÇ ÊâìÂºÄËèúÂçï');
            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            const container = menu.querySelector('.mobile-menu-container');

            menu.classList.remove('hidden');
            button.setAttribute('aria-expanded', 'true');

            if (container) {
                container.style.animation = 'mobileMenuSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                setTimeout(() => {
                    this.isToggling = false;
                    console.log('‚úÖ ËèúÂçïÊâìÂºÄÂÆåÊàê');
                }, 350);
            } else {
                this.isToggling = false;
            }
        },

        close: function() {
            if (this.isToggling) return;
            this.isToggling = true;

            console.log('üìÅ ÂÖ≥Èó≠ËèúÂçï');
            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            const container = menu.querySelector('.mobile-menu-container');

            button.setAttribute('aria-expanded', 'false');

            if (container) {
                container.style.animation = 'mobileMenuSlideOut 0.2s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                setTimeout(() => {
                    menu.classList.add('hidden');
                    container.style.animation = '';
                    this.isToggling = false;
                    console.log('‚úÖ ËèúÂçïÂÖ≥Èó≠ÂÆåÊàê');
                }, 250);
            } else {
                menu.classList.add('hidden');
                this.isToggling = false;
            }
        },

        destroy: function() {
            console.log('üóëÔ∏è ÈîÄÊØÅÁßªÂä®Á´ØËèúÂçïÁÆ°ÁêÜÂô®');

            if (this.outsideClickHandler) {
                document.removeEventListener('click', this.outsideClickHandler);
                this.outsideClickHandler = null;
            }

            if (this.buttonClickHandler) {
                const button = document.getElementById('mobile-menu-button');
                if (button) {
                    button.removeEventListener('click', this.buttonClickHandler, { capture: true });
                }
                this.buttonClickHandler = null;
            }

            this.isInitialized = false;
            this.isToggling = false;
        }
    };

    return mobileMenuManager;
}

// =============== HeaderÁªÑ‰ª∂ ===============

// Ê∏≤ÊüìHeaderÁªÑ‰ª∂ - Âú®ÊñáÁ´†È°µÈù¢ÊòæÁ§∫ÂÖÉ‰ø°ÊÅØ
function renderHeader(currentPath, isRoot) {
    // Âè™Âú®ÊñáÁ´†È°µÈù¢ÊòæÁ§∫
    const isArticlePage = currentPath.includes('docs/') && !currentPath.endsWith('index.html');
    if (!isArticlePage) {
        console.log('‚ùå ÈùûÊñáÁ´†È°µÈù¢ÔºåË∑≥ËøáheaderÊ∏≤Êüì');
        return;
    }

    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®headerÁªÑ‰ª∂
    let headerElement = document.querySelector('[data-component="header"]');

    // Â¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÂàõÂª∫Êñ∞ÁöÑheaderÁªÑ‰ª∂
    if (!headerElement) {
        console.log('üìù ÂàõÂª∫Êñ∞ÁöÑheaderÁªÑ‰ª∂');
        headerElement = document.createElement('div');
        headerElement.setAttribute('data-component', 'header');
        headerElement.className = 'header-component glass-effect';

        // ÊèíÂÖ•Âà∞bodyÁöÑÂºÄÂ§¥
        const bodyElement = document.body;
        if (bodyElement) {
            bodyElement.insertBefore(headerElement, bodyElement.firstChild);
            // ÁªôbodyÊ∑ªÂä†classÔºåÁ°Æ‰øùÈ°µÈù¢ÂÜÖÂÆπ‰∏çË¢´ÈÅÆÊå°
            bodyElement.classList.add('has-fixed-header');
            console.log('‚úÖ HeaderÁªÑ‰ª∂Â∑≤ÊèíÂÖ•Âà∞bodyÂºÄÂ§¥');
        } else {
            console.warn('‚ö†Ô∏è Êó†Ê≥ïÊâæÂà∞bodyÂÖÉÁ¥†');
            return;
        }
    } else {
        headerElement.classList.add('header-component', 'glass-effect');
    }

    // Ë∑ØÂæÑÂ§ÑÁêÜÈÄªËæë
    let prefix = '';
    if (!isRoot) {
        const pathSegments = currentPath.split('/');
        if (pathSegments.length >= 2 && pathSegments[0] === 'docs') {
            prefix = '../../';
        } else if (pathSegments.length >= 1) {
            prefix = '../';
        }
    }

    // Ëé∑ÂèñÂÖÉÊï∞ÊçÆ
    const metadata = getPageMetadata(currentPath);

    // ËÆæÁΩÆÈªòËÆ§ÂÄº
    const today = new Date();
    const dateStr = metadata?.date || `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    let tags = metadata && metadata.tags ? metadata.tags : ['ÂçöÂÆ¢'];

    // ‰ΩøÁî®ÂÖ±‰∫´ÁöÑÊ†áÁ≠æÊûÑÂª∫ÂáΩÊï∞ - Ëá™Âä®Ê£ÄÊµãËÉåÊôØËâ≤
    let tagsHtml = '';
    if (typeof buildTagsHtml === 'function') {
        tagsHtml = buildTagsHtml(tags, {
            padding: 'px-3 py-1',
            withAnimation: true
            // ‰∏çÊåáÂÆö isDarkBackgroundÔºåËÆ©ÂáΩÊï∞Ëá™Âä®Ê£ÄÊµã
        });
    } else {
        // ÂõûÈÄÄÂà∞ÂéüÂßãÊñπÊ≥ï - ‰πü‰ΩøÁî®Ëá™Âä®Ê£ÄÊµã
        const isPageDark = typeof window.isDarkBackground === 'function' ? window.isDarkBackground() : true;
        const tagColors = getTagColorsForTags ? getTagColorsForTags(tags, isPageDark) : tags.map(tag => getTagColorClass(tag, isPageDark));
        tagsHtml = tags.map((tag, index) => {
            const colorClass = tagColors[index] || getTagColorClass(tag, isPageDark);
            return `<span class="inline-block ${colorClass} hover:opacity-80 transition-all duration-200 hover:scale-105 rounded-full px-3 py-1 text-xs font-medium border tag-animate" style="animation-delay: ${index * 0.1}s">${tag}</span>`;
        }).join('');
    }

    const homeLink = `${prefix}index.html`;

    // Ê∑ªÂä†headerÊ†∑Âºè
    const headerStyles = `
        <style>
            .header-component {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100vw !important;
                margin: 0 !important;
                z-index: 1001 !important;
                opacity: 0;
                transform: translateY(-20px);
                animation: slideInFromTop 0.6s ease-out forwards;
            }

            @keyframes slideInFromTop {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Á°Æ‰øùÈ°µÈù¢ÂÜÖÂÆπ‰∏çË¢´headerÈÅÆÊå° */
            body.has-fixed-header {
                padding-top: 64px !important;
            }

            /* Â¢ûÂº∫ÁöÑÊØõÁéªÁíÉÊïàÊûú - ÈªòËÆ§Ê∑±Ëâ≤ËÉåÊôØ‰ºòÂåñ */
            .header-component .glass-effect {
                background: rgba(40, 40, 40, 0.7) !important; /* ÈÄöÁî®Ê∑±ÁÅ∞Ëâ≤ÔºåÈÄÇÈÖçÂêÑÁßçÊ∑±Ëâ≤ËÉåÊôØ */
                backdrop-filter: blur(30px) saturate(180%) !important;
                -webkit-backdrop-filter: blur(30px) saturate(180%) !important;
                border: none !important;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25) !important; /* Êõ¥ËΩªÁöÑÈò¥ÂΩ± */
            }

            /* ÊµÖËâ≤ËÉåÊôØÁöÑÊØõÁéªÁíÉÊïàÊûú - ËûçÂÖ•ËÉåÊôØËâ≤ÔºåÊó†ËæπÊ°Ü */
            .header-component.light-bg .glass-effect {
                background: rgba(234, 230, 225, 0.85) !important; /* ‰ΩøÁî®È°µÈù¢ËÉåÊôØËâ≤ #EAE6E1 */
                backdrop-filter: blur(20px) saturate(180%) !important;
                -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
                border: none !important;
                box-shadow: none !important;
            }

            /* ÊµÖËâ≤ËÉåÊôØ‰∏ãÁöÑÊó•ÊúüÊñáÂ≠ó */
            .header-component.light-bg .ultra-light-date {
                color: rgba(107, 114, 128, 0.8) !important;
            }
            .header-component.light-bg .ultra-light-date a {
                color: rgba(107, 114, 128, 0.8) !important;
            }
            .header-component.light-bg .ultra-light-date a:hover {
                color: rgba(107, 114, 128, 1) !important;
            }

            /* Ê∑±Ëâ≤ËÉåÊôØ‰∏ãÁöÑÊó•ÊúüÊñáÂ≠ó - Êõ¥ÁôΩÊõ¥Ê∏ÖÊô∞ */
            .ultra-light-date {
                color: rgba(255, 255, 255, 0.9) !important;
            }
            .ultra-light-date a {
                color: rgba(255, 255, 255, 0.9) !important;
            }
            .ultra-light-date a:hover {
                color: rgba(255, 255, 255, 1) !important;
            }

            .tag-animate {
                opacity: 0;
                transform: translateY(10px);
                animation: tagFadeIn 0.4s ease-out forwards;
            }

            @keyframes tagFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>
    `;

    // ‰ΩøÁî®ÂØºËà™Ê†èÁöÑÂ∏ÉÂ±ÄÁªìÊûÑÔºå‰ΩÜÂ°´ÂÖ•ÂÖÉ‰ø°ÊÅØÂÜÖÂÆπ
    headerElement.innerHTML = `
        ${headerStyles}
        <div class="w-full glass-effect">
            <div class="container mx-auto px-4 py-3 flex flex-wrap justify-between items-center">
                <div class="flex items-center ultra-light-date">
                    <a href="${homeLink}" class="home-link">
                        <i class="fa-solid fa-home mr-2" aria-hidden="true"></i>
                    </a>
                    <span class="text-sm font-medium">${dateStr}</span>
                </div>
                <div class="flex flex-wrap gap-2 mt-2 md:mt-0">
                    ${tagsHtml}
                </div>
            </div>
        </div>
    `;

    // Ê†πÊçÆËÉåÊôØËâ≤Âä®ÊÄÅË∞ÉÊï¥ÊØõÁéªÁíÉÊïàÊûú
    setTimeout(() => {
        if (typeof window.isDarkBackground === 'function') {
            const isDark = window.isDarkBackground();
            console.log('üé® Ê†πÊçÆËÉåÊôØËâ≤Ë∞ÉÊï¥ÊØõÁéªÁíÉÊïàÊûú:', isDark ? 'Ê∑±Ëâ≤ËÉåÊôØ' : 'ÊµÖËâ≤ËÉåÊôØ');

            if (!isDark) {
                // ÊµÖËâ≤ËÉåÊôØÔºöÊ∑ªÂä†light-bgÁ±ª
                headerElement.classList.add('light-bg');
                console.log('‚úÖ Â∫îÁî®ÊµÖËâ≤ËÉåÊôØÊØõÁéªÁíÉÊïàÊûú');
            } else {
                // Ê∑±Ëâ≤ËÉåÊôØÔºöÁßªÈô§light-bgÁ±ªÔºà‰ΩøÁî®ÈªòËÆ§Ê∑±Ëâ≤ÊïàÊûúÔºâ
                headerElement.classList.remove('light-bg');
                console.log('‚úÖ Â∫îÁî®Ê∑±Ëâ≤ËÉåÊôØÊØõÁéªÁíÉÊïàÊûú');
            }
        }
    }, 100);

    console.log('‚úÖ HeaderÁªÑ‰ª∂ÔºàÂåÖÂê´ÂÖÉ‰ø°ÊÅØÔºâÊ∏≤ÊüìÂÆåÊàê');
}

// =============== FooterÁªÑ‰ª∂ ===============

// Ê∏≤ÊüìFooterÁªÑ‰ª∂
function renderFooter(isRoot) {
    const footerElement = document.querySelector('[data-component="footer"]');
    if (!footerElement) return;
    if (isRoot) {
        footerElement.innerHTML = `
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 flex justify-between items-center">
                <p class="footer-text">¬© 2025 <span class="text-primary font-semibold">JerryBob</span>. All rights reserved.</p>
                <div class="flex space-x-4">
                    <a href="https://web.okjike.com/u/8d6e830c-4da1-4753-ab41-020b91002aec" target="_blank" class="social-button bg-yellow-400">
                        <span class="social-button-text">J</span>
                    </a>
                    <a href="https://x.com/JerryBobAI" target="_blank" class="social-button bg-black">
                        <span class="social-button-text">X</span>
                    </a>
                </div>
            </div>
        `;
        footerElement.style.display = 'block';
        footerElement.style.opacity = '1';
        console.log('È¶ñÈ°µÊòæÁ§∫footer');
    } else {
        footerElement.style.display = 'none';
        console.log('ÈùûÈ¶ñÈ°µ‰∏çÊòæÁ§∫footer');
    }
}

// =============== Article MetaÁªÑ‰ª∂ ===============

// Ê∏≤ÊüìÊñáÁ´†ÂÖÉ‰ø°ÊÅØÁªÑ‰ª∂ - ÂäüËÉΩÂ∑≤ÁßªÂà∞header‰∏≠
function renderArticleMeta(currentPath, metadataCache) {
    // ÂäüËÉΩÂ∑≤ÁßªÂà∞ renderHeader ‰∏≠Ôºå‰∏çÂÜçÂçïÁã¨Ê∏≤Êüì
    console.log('‚ÑπÔ∏è ÂÖÉ‰ø°ÊÅØÂäüËÉΩÂ∑≤ÁßªÂà∞headerÁªÑ‰ª∂‰∏≠');
    return;

    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÂÖÉ‰ø°ÊÅØÁªÑ‰ª∂
    let articleMetaElement = document.querySelector('[data-component="article-meta"]');

    // Â¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÂàõÂª∫Êñ∞ÁöÑÂÖÉ‰ø°ÊÅØÁªÑ‰ª∂
    if (!articleMetaElement) {
        console.log('üìù ÂàõÂª∫Êñ∞ÁöÑÂÖÉ‰ø°ÊÅØÁªÑ‰ª∂');
        articleMetaElement = document.createElement('div');
        articleMetaElement.setAttribute('data-component', 'article-meta');
        articleMetaElement.className = 'article-meta-component';

        // ÊèíÂÖ•Âà∞bodyÂºÄÂ§¥
        const bodyElement = document.body;

        if (bodyElement) {
            bodyElement.insertBefore(articleMetaElement, bodyElement.firstChild);
            console.log('‚úÖ ÂÖÉ‰ø°ÊÅØÁªÑ‰ª∂Â∑≤ÊèíÂÖ•Âà∞bodyÂºÄÂ§¥');
        } else {
            console.warn('‚ö†Ô∏è Êó†Ê≥ïÊâæÂà∞ body ÂÖÉÁ¥†');
            return;
        }
    }

    // Ëé∑ÂèñÂÖÉÊï∞ÊçÆ
    const metadata = getPageMetadata(currentPath);
    console.log('üìä Ëé∑ÂèñÂà∞ÁöÑÂÖÉÊï∞ÊçÆ:', metadata);

    // ËÆæÁΩÆÈªòËÆ§ÂÄº
    const today = new Date();
    const dateStr = metadata?.date || `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    let tags = metadata && metadata.tags ? metadata.tags : ['ÂçöÂÆ¢'];

    console.log('üìÖ ‰ΩøÁî®ÁöÑÊó•Êúü:', dateStr);
    console.log('üè∑Ô∏è ‰ΩøÁî®ÁöÑÊ†áÁ≠æ:', tags);

    // ‰ΩøÁî®ÂÖ±‰∫´ÁöÑÊ†áÁ≠æÊûÑÂª∫ÂáΩÊï∞
    let tagsHtml = '';
    if (typeof buildTagsHtml === 'function') {
        tagsHtml = buildTagsHtml(tags, {
            padding: 'px-3 py-1',
            withAnimation: true
        });
    } else {
        console.error('‚ùå buildTagsHtml ÂáΩÊï∞Êú™ÂÆö‰πâÔºåÂõûÈÄÄÂà∞ÂéüÂßãÊñπÊ≥ï');
        // ÂõûÈÄÄÂà∞ÂéüÂßãÊñπÊ≥ï
        const tagColors = getTagColorsForTags ? getTagColorsForTags(tags) : tags.map(tag => getTagColorClass(tag));
        tagsHtml = tags.map((tag, index) => {
            const colorClass = tagColors[index] || getTagColorClass(tag);
            return `<span class="inline-block ${colorClass} hover:opacity-80 transition-all duration-200 hover:scale-105 rounded-full px-3 py-1 text-xs font-medium border tag-animate" style="animation-delay: ${index * 0.1}s">${tag}</span>`;
        }).join('');
    }

    // ÊûÑÂª∫ÂÖÉ‰ø°ÊÅØ HTML
    let homeLink = "../../index.html";
    if (currentPath.split('/').length <= 2) {
        homeLink = "../index.html";
    }

    // ÁÆÄÂåñÊ†∑Âºè
    const styles = `
        <style>
            /* ÁßªÈô§ÈáçÂ§çÁöÑCSSÔºå‰ΩøÁî®CSSÊñá‰ª∂‰∏≠ÁöÑÁªü‰∏ÄÊ†∑Âºè */
            .ultra-light-date {
                color: rgba(107, 114, 128, 0.7);
            }
            .ultra-light-date a {
                color: rgba(107, 114, 128, 0.7);
            }
            .ultra-light-date a:hover {
                color: rgba(107, 114, 128, 0.9);
            }
            /* ÁÆÄÂåñÁöÑ meta ‰ø°ÊÅØÊ†∑Âºè */
            .article-meta-component {
                position: sticky !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100vw !important;
                margin: 0 !important;
                z-index: 1000 !important;
                opacity: 0;
                transform: translateY(-20px);
                animation: slideInFromTop 0.6s ease-out forwards;
            }

            @keyframes slideInFromTop {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .article-meta-blur {
                transition: all 0.3s ease;
            }

            .tag-animate {
                opacity: 0;
                transform: translateY(10px);
                animation: tagFadeIn 0.4s ease-out forwards;
            }

            @keyframes tagFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>
    `;

    // Ê∏≤Êüì HTML ÂÜÖÂÆπ - ‰øùÊåÅÂéüÊúâÁöÑÁÆÄÊ¥ÅËÆæËÆ°
    articleMetaElement.innerHTML = `
        ${styles}
        <div class="w-full article-meta-blur glass-effect">
            <div class="container mx-auto px-4 py-3 flex flex-wrap justify-between items-center">
                <div class="flex items-center ultra-light-date">
                    <a href="${homeLink}" class="home-link">
                        <i class="fa-solid fa-home mr-2" aria-hidden="true"></i>
                    </a>
                    <span class="text-sm font-medium">${dateStr}</span>
                </div>
                <div class="flex flex-wrap gap-2 mt-2 md:mt-0">
                    ${tagsHtml}
                </div>
            </div>
        </div>
    `;

    console.log('‚úÖ ÂÖÉ‰ø°ÊÅØÁªÑ‰ª∂Ê∏≤ÊüìÂÆåÊàê');
}

// =============== Â∏ÉÂ±ÄÁ≥ªÁªüÂàùÂßãÂåñ ===============

// ÂàùÂßãÂåñÊâÄÊúâÂ∏ÉÂ±ÄÁªÑ‰ª∂
async function initializeLayout() {
    console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñÂ∏ÉÂ±ÄÁªÑ‰ª∂');

    // Á≠âÂæÖÊ†∏ÂøÉÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê
    const coreState = await initializeCore();
    if (!coreState) {
        console.error('‚ùå Ê†∏ÂøÉÁ≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•');
        return;
    }

    const { currentPath, isRoot } = coreState;
    const metadataCache = getMetadataCache();

    // Ê∏≤ÊüìÂêÑÂ∏ÉÂ±ÄÁªÑ‰ª∂ - ÂÖÉ‰ø°ÊÅØÂäüËÉΩÂ∑≤ÁßªÂà∞header‰∏≠
    renderHeader(currentPath, isRoot);
    renderFooter(isRoot);

    console.log('‚úÖ Â∏ÉÂ±ÄÁªÑ‰ª∂ÂàùÂßãÂåñÂÆåÊàê');
}

// ÂØºÂá∫ÂáΩÊï∞‰æõÂÖ∂‰ªñÊ®°Âùó‰ΩøÁî®
if (typeof window !== 'undefined') {
    window.renderHeader = renderHeader;
    window.renderFooter = renderFooter;
    window.renderArticleMeta = renderArticleMeta;
    window.initializeLayout = initializeLayout;
}

// Â§öÁßçÊñπÂºèÁ°Æ‰øùÂ∏ÉÂ±ÄÁªÑ‰ª∂ËÉΩÂ§üÊ≠£Á°ÆÂä†ËΩΩ
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeLayout);
} else if (document.readyState === 'interactive') {
    // DOM Â∑≤Âä†ËΩΩ‰ΩÜËµÑÊ∫êÂèØËÉΩËøòÂú®Âä†ËΩΩ
    setTimeout(initializeLayout, 100);
} else {
    // È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
    initializeLayout();
}

// Â§áÁî®ÊñπÊ°àÔºöÂ¶ÇÊûú‰∏äÈù¢ÁöÑÈÉΩÊ≤°ÊâßË°åÔºåÂú® window.onload Êó∂ÊâßË°å
window.addEventListener('load', function() {
    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂàùÂßãÂåñËøá
    if (!document.querySelector('[data-component="article-meta"]')) {
        console.log('üîÑ Â§áÁî®ÊñπÊ°àÔºöÂú® window.onload Êó∂ÂàùÂßãÂåñÂ∏ÉÂ±Ä');
        initializeLayout();
    }
});
